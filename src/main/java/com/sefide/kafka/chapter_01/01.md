## 발행/구독 메세지 전달

- 특징

```
- 전송자(발행하는 쪽)가 데이터(메세지)를 보낼 때 직접 수신자(구독하는 쪽)로 보내지 않는 것.
- 전송자는 어떤 형태로든 메세지를 분류해서 보내고 수신자는 이렇게 분류된 메세지를 구독한다.
- 발행된 매세지를 전달받고 중계해주는 브로커
```

- 분산 커밋 로그, 분산 스트리밍 플랫폼라고 불리기도 함

## 카프카

- 메세지 : 데이터의 기본 단위
- 배치 : 같은 토픽의 파티션에 쓰여지는 메세지들의 집합 (메세지를 저장하는 단위)
    - 메세지를 쓰는데 막대한 오버헤드 발생 → 배치 단위로 모아서 쓴다.
    - tradeoff : 지연 ↔ 처리량
- 스키마 : 메세지 구조
    - json, xml, avro (apache에서 만든 직렬화 프레임워크, 스키마가 변경되어도 컨슈머 변경 처리 필요 없음)
- 토픽 : 메세지를 분류
- 파티션 : 토픽을 나누는 단위
    - 데이터 중복과 확장성을 제공
    - 단일 파티션 안에서만 메세지의 순서가 보장됨
- 스트림 : 프로듀서로부터 컨슈머로의 하나의 데이터 흐름, 하나의 토픽에 저장된 데이터..
- 프로듀서 : 메세지 발행 주체
    - 특정 파티션을 지정해서 메세지를 쓸 수 있음 (partitioner)
- 컨슈머 : 메세지를 읽는 주체 = 구독자
    - 토픽 구독
    - 파티션에 쓰여진 순서대로 메세지들을 읽음
    - 메세지의 오프셋을 기록
- 오프셋 : 지속적으로 증가하는 정수값
    - 카프카가 메시지를 저장할 때 각각의 메시지에 부여해주는 메타데이터
    - 주어진 파티션의 . 각메세지는 고유한 오프셋을 가지고 파티션 별로 다음 번에 사용 가능한 오프셋 값을 저장한다.
- 컨슈머 그룹 : 토픽에 저장된 데이터를 읽어오기 위해 협업하는 하나 이상의 컨슈머
    - 각 파티션이 하나의 컨슈머에 의해서만 읽히도록 조정
        - 파티션 1 → 컨슈머 1
        - 컨슈머 1 → 파티션 1, 2 가능
- 브로커 : 카프카 서버
    - 프로듀서로부터 메세지를 전달받아 오프셋을 할당한 뒤 디스크 저장소에 쓴다.
    - 컨슈머의 파티션 읽기 요청 및 발행된 메시지 전송
    - 하나의 클러스터 안에 여러 개의 브로커가 포함될 수 있다.
    - 클러스터 컨트롤러
        - 파티션을 브로커에 할당
        - 장애가 발생한 브로커 모니터링
- 주키퍼 : 설정 정보 관리, 이름 부여, 분산 동기화, 그룹 서비스를 제공하는 중앙화된 서비스
- 보존 기능 : 기간, 사이즈에 따라 보존 설정 가능
- 로그 압착
- 다중 클러스터
    - 데이터 유형별 분리
    - 보안 요구사항을 충족시키기 위한 격리
    - 재해 복구를 대비한 다중 데이터센터

+미러메이커 : 데이터를 다른 클러스터로 복제할 때 사용하는 툴

## 카프카의 장점

- 다중 프로듀서
- 다중 컨슈머
- **디스크 기반 보존**
- 확장성
- 고성능
- 플랫폼 기능
    - [카프카 커넥트](https://velog.io/@holicme7/Apache-Kafka-Kafka-Connect-%EB%9E%80)
    - 카프카 스트림즈

## 데이터 생태계

- 활동 추적
- 메세지 교환
- 지표 및 로그 수집
- 커밋 로그
- 스트림 처리
    - 실시간 데이터 처리!!!!